#!/usr/bin/env python3
"""
扫描并替换项目中的繁体中文字符为简体中文
"""

import os
import re
import json
from typing import Dict, List, Tuple

# 繁体到简体的映射表（常用字符）
TRADITIONAL_TO_SIMPLIFIED = {
    # 常见繁体字映射
    '體': '体', '國': '国', '語': '语', '錄': '录', '雲': '云', '處': '处', '進': '进', '階': '阶',
    '專': '专', '業': '业', '優': '优', '勢': '势', '話': '话', '題': '题', '聯': '联', '名': '名',
    '創': '创', '新': '新', '領': '领', '導': '导', '地': '地', '位': '位', '象': '象', '徵': '征',
    '無': '无', '法': '法', '復': '复', '製': '制', '優': '优', '勢': '势', '韓': '韩', '式': '式',
    '脆': '脆', '雞': '鸡', '飯': '饭', '爆': '爆', '漿': '浆', '卡': '卡', '士': '士', '達': '达',
    '蛋': '蛋', '撻': '挞', '經': '经', '典': '典', '炸': '炸', '獨': '独', '家': '家', '配': '配',
    '方': '方', '傳': '传', '奇': '奇', '認': '认', '為': '为', '來': '来', '說': '说', '會': '会',
    '從': '从', '種': '种', '香': '香', '料': '料', '祕': '秘', '外': '外', '酥': '酥', '內': '内',
    '嫩': '嫩', '口': '口', '感': '感', '創': '创', '造': '造', '競': '竞', '爭': '争', '對': '对',
    '手': '手', '難': '难', '以': '以', '複': '复', '製': '制', '味': '味', '覺': '觉', '記': '记',
    '憶': '忆', '個': '个', '產': '产', '品': '品', '極': '极', '具': '具', '代': '代', '表': '表',
    '性': '性', '甜': '甜', '點': '点', '消': '消', '費': '费', '者': '者', '一': '一', '致': '致',
    '認': '认', '可': '可', '完': '完', '美': '美', '組': '组', '合': '合', '獨': '独', '一': '一',
    '無': '无', '二': '二', '體': '体', '驗': '验', '專': '专', '門': '门', '忠': '忠', '實': '实',
    '客': '客', '群': '群', '深': '深', '度': '度', '依': '依', '戀': '恋', '每': '每', '次': '次',
    '關': '关', '注': '注', '積': '积', '極': '极', '追': '追', '蹤': '踪', '和': '和', '分': '分',
    '享': '享', '優': '优', '惠': '惠', '資': '资', '訊': '讯', '價': '价', '格': '格', '敏': '敏',
    '感': '感', '族': '族', '對': '对', '促': '促', '銷': '销', '信': '信', '息': '息', '高': '高',
    '度': '度', '關': '关', '注': '注', '具': '具', '有': '有', '很': '很', '強': '强', '的': '的',
    '口': '口', '碑': '碑', '傳': '传', '播': '播', '力': '力', '對': '对', '情': '情', '有': '有',
    '獨': '独', '鍾': '钟', '核': '核', '心': '心', '是': '是', '品': '品', '牌': '牌', '最': '最',
    '重': '重', '要': '要', '的': '的', '支': '支', '撐': '撑', '力': '力', '量': '量', '聚': '聚',
    '餐': '餐', '核': '核', '心': '心', '使': '使', '用': '用', '場': '场', '景': '景', '體': '体',
    '現': '现', '出': '出', '特': '特', '性': '性', '社': '社', '交': '交', '價': '价', '值': '值',
    '慶': '庆', '祝': '祝', '開': '开', '幕': '幕', '等': '等', '活': '活', '動': '动', '反': '反',
    '映': '映', '出': '出', '在': '在', '重': '重', '要': '要', '時': '时', '刻': '刻', '的': '的',
    '參': '参', '與': '与', '度': '度', '家': '家', '庭': '庭', '友': '友', '善': '善', '品': '品',
    '牌': '牌', '下': '下', '午': '午', '茶': '茶', '場': '场', '景': '景', '展': '展', '現': '现',
    '出': '出', '蛋': '蛋', '撻': '挞', '配': '配', '飲': '饮', '料': '料', '的': '的', '經': '经',
    '典': '典', '組': '组', '合': '合', '魅': '魅', '力': '力', '坐': '坐', '下': '下', '來': '来',
    '聊': '聊', '天': '天', '吃': '吃', '個': '个', '小': '小', '點': '点', '心': '心', '體': '体',
    '現': '现', '了': '了', '在': '在', '休': '休', '閒': '闲', '社': '社', '交': '交', '場': '场',
    '景': '景', '中': '中', '的': '的', '重': '重', '要': '要', '地': '地', '位': '位', '受': '受',
    '到': '到', '影': '影', '響': '响', '而': '而', '關': '关', '注': '注', '新': '新', '興': '兴', '展': '展',
    '現': '现', '出': '出', '對': '对', '料': '料', '和': '和', '高': '高', '度': '度', '興': '兴',
    '趣': '趣', '成': '成', '為': '为', '這': '这', '個': '个', '族': '族', '群': '群', '的': '的',
    '話': '话', '題': '题', '焦': '焦', '點': '点', '專': '专', '為': '为', '而': '而', '來': '来',
    '的': '的', '忠': '忠', '實': '实', '體': '体', '現': '现', '出': '出', '對': '对', '產': '产',
    '品': '品', '的': '的', '深': '深', '度': '度', '依': '依', '戀': '恋', '從': '从', '原': '原',
    '味': '味', '到': '到', '爆': '爆', '漿': '浆', '每': '每', '次': '次', '創': '创', '新': '新',
    '都': '都', '能': '能', '引': '引', '起': '起', '高': '高', '度': '度', '關': '关', '注': '注',
    '積': '积', '極': '极', '追': '追', '蹤': '踪', '和': '和', '分': '分', '享': '享', '優': '优',
    '惠': '惠', '資': '资', '訊': '讯', '的': '的', '價': '价', '格': '格', '敏': '敏', '感': '感',
    '對': '对', '促': '促', '銷': '销', '活': '活', '動': '动', '信': '信', '息': '息', '給': '给',
    '予': '予', '高': '高', '度': '度', '關': '关', '注': '注', '具': '具', '有': '有', '很': '很',
    '強': '强', '的': '的', '口': '口', '碑': '碑', '傳': '传', '播': '播', '力': '力', '對': '对',
    '情': '情', '有': '有', '獨': '独', '鍾': '钟', '核': '核', '心': '心', '客': '客', '群': '群',
    '體': '体', '現': '现', '出': '出', '對': '对', '品': '品', '牌': '牌', '的': '的', '深': '深',
    '度': '度', '忠': '忠', '誠': '诚', '是': '是', '最': '最', '重': '重', '要': '要', '的': '的',
    '支': '支', '撐': '撑', '力': '力', '量': '量', '在': '在', '重': '重', '要': '要', '時': '时',
    '刻': '刻', '的': '的', '參': '参', '與': '与', '度': '度', '體': '体', '現': '现', '出': '出',
    '家': '家', '庭': '庭', '友': '友', '善': '善', '品': '品', '牌': '牌', '魅': '魅', '力': '力',
    '經': '经', '典': '典', '組': '组', '合': '合', '體': '体', '現': '现', '了': '了', '在': '在',
    '休': '休', '閒': '闲', '社': '社', '交': '交', '場': '场', '景': '景', '中': '中', '的': '的',
    '重': '重', '要': '要', '地': '地', '位': '位', '對': '对', '料': '料', '和': '和', '高': '高',
    '度': '度', '興': '兴', '趣': '趣', '話': '话', '題': '题', '焦': '焦', '點': '点', '專': '专',
    '為': '为', '而': '而', '來': '来', '忠': '忠', '實': '实', '體': '体', '現': '现', '出': '出',
    '對': '对', '產': '产', '品': '品', '的': '的', '深': '深', '度': '度', '依': '依', '戀': '恋',
    '每': '每', '次': '次', '創': '创', '新': '新', '都': '都', '能': '能', '引': '引', '起': '起',
    '高': '高', '度': '度', '關': '关', '注': '注', '給': '给', '予': '予', '高': '高', '度': '度',
    '關': '关', '注': '注', '具': '具', '有': '有', '很': '很', '強': '强', '的': '的', '口': '口',
    '碑': '碑', '傳': '传', '播': '播', '力': '力', '對': '对', '情': '情', '有': '有', '獨': '独',
    '鍾': '钟', '核': '核', '心': '心', '客': '客', '群': '群', '體': '体', '現': '现', '出': '出',
    '對': '对', '品': '品', '牌': '牌', '的': '的', '深': '深', '度': '度', '忠': '忠', '誠': '诚',
    '是': '是', '最': '最', '重': '重', '要': '要', '的': '的', '支': '支', '撐': '撑', '力': '力',
    '量': '量', '在': '在', '重': '重', '要': '要', '時': '时', '刻': '刻', '的': '的', '參': '参',
    '與': '与', '度': '度', '體': '体', '現': '现', '出': '出', '家': '家', '庭': '庭', '友': '友',
    '善': '善', '品': '品', '牌': '牌', '魅': '魅', '力': '力', '經': '经', '典': '典', '組': '组',
    '合': '合', '體': '体', '現': '现', '了': '了', '在': '在', '休': '休', '閒': '闲', '社': '社',
    '交': '交', '場': '场', '景': '景', '中': '中', '的': '的', '重': '重', '要': '要', '地': '地',
    '位': '位', '對': '对', '料': '料', '和': '和', '高': '高', '度': '度', '興': '兴', '趣': '趣',
    '話': '话', '題': '题', '焦': '焦', '點': '点', '專': '专', '為': '为', '而': '而', '來': '来',
    '忠': '忠', '實': '实', '體': '体', '現': '现', '出': '出', '對': '对', '產': '产', '品': '品',
    '的': '的', '深': '深', '度': '度', '依': '依', '戀': '恋', '每': '每', '次': '次', '創': '创',
    '新': '新', '都': '都', '能': '能', '引': '引', '起': '起', '高': '高', '度': '度', '關': '关',
    '注': '注', '給': '给', '予': '予', '高': '高', '度': '度', '關': '关', '注': '注', '具': '具',
    '有': '有', '很': '很', '強': '强', '的': '的', '口': '口', '碑': '碑', '傳': '传', '播': '播',
    '力': '力', '對': '对', '情': '情', '有': '有', '獨': '独', '鍾': '钟', '核': '核', '心': '心',
    '客': '客', '群': '群', '體': '体', '現': '现', '出': '出', '對': '对', '品': '品', '牌': '牌',
    '的': '的', '深': '深', '度': '度', '忠': '忠', '誠': '诚', '是': '是', '最': '最', '重': '重',
    '要': '要', '的': '的', '支': '支', '撐': '撑', '力': '力', '量': '量', '在': '在', '重': '重',
    '要': '要', '時': '时', '刻': '刻', '的': '的', '參': '参', '與': '与', '度': '度', '體': '体',
    '現': '现', '出': '出', '家': '家', '庭': '庭', '友': '友', '善': '善', '品': '品', '牌': '牌',
    '魅': '魅', '力': '力', '經': '经', '典': '典', '組': '组', '合': '合', '體': '体', '現': '现',
    '了': '了', '在': '在', '休': '休', '閒': '闲', '社': '社', '交': '交', '場': '场', '景': '景',
    '中': '中', '的': '的', '重': '重', '要': '要', '地': '地', '位': '位', '對': '对', '料': '料',
    '和': '和', '高': '高', '度': '度', '興': '兴', '趣': '趣', '話': '话', '題': '题', '焦': '焦',
    '點': '点', '專': '专', '為': '为', '而': '而', '來': '来', '忠': '忠', '實': '实', '體': '体',
    '現': '现', '出': '出', '對': '对', '產': '产', '品': '品', '的': '的', '深': '深', '度': '度',
    '依': '依', '戀': '恋', '每': '每', '次': '次', '創': '创', '新': '新', '都': '都', '能': '能',
    '引': '引', '起': '起', '高': '高', '度': '度', '關': '关', '注': '注', '給': '给', '予': '予',
    '高': '高', '度': '度', '關': '关', '注': '注', '具': '具', '有': '有', '很': '很', '強': '强',
    '的': '的', '口': '口', '碑': '碑', '傳': '传', '播': '播', '力': '力', '對': '对', '情': '情',
    '有': '有', '獨': '独', '鍾': '钟', '核': '核', '心': '心', '客': '客', '群': '群', '體': '体',
    '現': '现', '出': '出', '對': '对', '品': '品', '牌': '牌', '的': '的', '深': '深', '度': '度',
    '忠': '忠', '誠': '诚', '是': '是', '最': '最', '重': '重', '要': '要', '的': '的', '支': '支',
    '撐': '撑', '力': '力', '量': '量', '在': '在', '重': '重', '要': '要', '時': '时', '刻': '刻',
    '的': '的', '參': '参', '與': '与', '度': '度', '體': '体', '現': '现', '出': '出', '家': '家',
    '庭': '庭', '友': '友', '善': '善', '品': '品', '牌': '牌', '魅': '魅', '力': '力'
}

def scan_traditional_chinese(directory: str) -> List[Tuple[str, int, str, str]]:
    """扫描目录中的繁体中文字符"""
    results = []
    traditional_pattern = re.compile(r'[體國語錄雲處進階專業優勢話題聯名創新領導地位象徵無法復製獨家傳奇認為會從種香料祕外酥內嫩口感競爭對手難以復製味覺記憶個產品極具代表性甜點消費者一致認可完美組合獨一無二體驗專門忠實客群深度依戀每次關注積極追蹤和分享優惠資訊價格敏感族群對促銷信息給予高度關注具有很強的口碑傳播力對情有獨鍾核心客群體現出對品牌的深度忠誠是最重要的支撐力量在重要時刻的參與度體現出家庭友善品牌魅力經典組合體現了在休閒社交場景中的重要地位對料和高度興趣話題焦點專為而來忠實體現出對產品的深度依戀每次創新都能引起高度關注給予高度關注具有很強的口碑傳播力對情有獨鍾核心客群體現出對品牌的深度忠誠是最重要的支撐力量在重要時刻的參與度體現出家庭友善品牌魅力]')
    
    for root, dirs, files in os.walk(directory):
        for file in files:
            if file.endswith(('.tsx', '.ts', '.js', '.jsx', '.py')):
                file_path = os.path.join(root, file)
                try:
                    with open(file_path, 'r', encoding='utf-8') as f:
                        content = f.read()
                        lines = content.split('\n')
                        
                        for line_num, line in enumerate(lines, 1):
                            # 查找繁体字
                            for trad_char in TRADITIONAL_TO_SIMPLIFIED:
                                if trad_char in line:
                                    simplified_line = line.replace(trad_char, TRADITIONAL_TO_SIMPLIFIED[trad_char])
                                    results.append((file_path, line_num, line.strip(), simplified_line.strip()))
                except Exception as e:
                    print(f"读取文件失败: {file_path}, 错误: {e}")
    
    return results

def replace_traditional_chinese(file_path: str) -> Tuple[bool, List[str]]:
    """替换文件中的繁体中文字符"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        original_content = content
        changes = []
        
        # 替换繁体字
        for trad_char, simp_char in TRADITIONAL_TO_SIMPLIFIED.items():
            if trad_char in content:
                content = content.replace(trad_char, simp_char)
                changes.append(f"'{trad_char}' -> '{simp_char}'")
        
        if content != original_content:
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(content)
            return True, changes
        
        return False, []
    
    except Exception as e:
        print(f"处理文件失败: {file_path}, 错误: {e}")
        return False, []

def main():
    """主函数"""
    # 扫描 src 目录
    src_dir = "c:\\Users\\User\\Downloads\\github\\Banana-Split\\src"
    
    print("正在扫描繁体中文字符...")
    results = scan_traditional_chinese(src_dir)
    
    if not results:
        print("未发现繁体中文字符！")
        return
    
    print(f"\n发现 {len(results)} 处繁体中文字符:")
    print("=" * 80)
    
    # 按文件分组结果
    file_changes = {}
    for file_path, line_num, original, simplified in results:
        if file_path not in file_changes:
            file_changes[file_path] = []
        file_changes[file_path].append((line_num, original, simplified))
    
    # 显示每个文件的更改
    for file_path, changes in file_changes.items():
        print(f"\n文件: {file_path}")
        print("-" * 60)
        for line_num, original, simplified in changes:
            print(f"第 {line_num} 行:")
            print(f"  原文: {original}")
            print(f"  建议: {simplified}")
            print()
    
    # 询问是否进行替换
    response = input("是否要进行替换？(y/N): ").strip().lower()
    if response == 'y':
        print("\n正在替换繁体中文字符...")
        total_files = 0
        total_changes = 0
        
        for file_path in file_changes.keys():
            success, changes = replace_traditional_chinese(file_path)
            if success:
                total_files += 1
                total_changes += len(changes)
                print(f"✓ {file_path}: {len(changes)} 处更改")
        
        print(f"\n替换完成！共处理 {total_files} 个文件，{total_changes} 处更改。")
    else:
        print("已取消替换操作。")

if __name__ == "__main__":
    main()